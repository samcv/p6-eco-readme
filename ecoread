#!/usr/bin/env perl6
use v6;
#use LWP::Simple;
#use IO::Socket::SSL; # XXX Digest broken 20151005
use Net::Curl::Easy; # XXX

use Panda;
use Panda::Ecosystem;
use Panda::App;
use IO::Capture::Simple;

sub MAIN (*@module) { 

    my $panda = Panda.new(:ecosystem(make-default-ecosystem()));
    
    # XXX capture STDOUT but better to have an accessible API
    my @lines = (capture_stdout { projectinfo($panda, @module) }).split("\n");

    my $found = @lines.grep(/'Source-url'/).list.join;

    $found=$found.split("github.com").list.[1].subst(".git","");

    $found = "https://raw.githubusercontent.com{$found}/master/README";

    my @urls = $found X~ (".md", "", ".txt",".pod");

    my $md;
    for @urls -> $url {

        $md = Net::Curl::Easy.new(:$url).download;

        last if $md !~~ "Not Found"


    };

    $md.say;
}
